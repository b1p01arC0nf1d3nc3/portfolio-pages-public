<!DOCTYPE html>
<html lang="en-us" dir="ltr" class="scroll-smooth" data-default-appearance="dark"
  data-auto-appearance="true"><head>
  <meta charset="utf-8" />
  
  <meta http-equiv="content-language" content="en-us" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  
  <title>TheHive &middot; b1p01arc0nf1d3nc3 - Portfolio</title>
  <meta name="title" content="TheHive &middot; b1p01arc0nf1d3nc3 - Portfolio" />
  
  
  
  
  
  <link rel="canonical" href="https://b1p01arc0nf1d3nc3.github.io/portfolio-pages-public/posts/thehive/" />
  
  
  
  
  
  
  
  
  
  
  <link type="text/css" rel="stylesheet" href="/portfolio-pages-public/css/main.bundle.min.d7ca24ae7b9653687701a1b5ff9da46dca5c5aadcb99b39d6a30ffce96aec470726940dc84ac5183d465fdd191a0147d90eb2e25bed8a3202a8ea9acca579bf0.css"
    integrity="sha512-18okrnuWU2h3AaG1/52kbcpcWq3LmbOdajD/zpauxHByaUDchKxRg9Rl/dGRoBR9kOsuJb7YoyAqjqmsyleb8A==" />
  
  
  <script type="text/javascript" src="/portfolio-pages-public/js/appearance.min.516a16745bea5a9bd011138d254cc0fd3973cd55ce6e15f3dec763e7c7c2c7448f8fe7b54cca811cb821b0c7e12cd161caace1dd794ac3d34d40937cbcc9ee12.js"
    integrity="sha512-UWoWdFvqWpvQERONJUzA/TlzzVXObhXz3sdj58fCx0SPj&#43;e1TMqBHLghsMfhLNFhyqzh3XlKw9NNQJN8vMnuEg=="></script>
  
  
  
  
  
  
  
  
  
  <script defer type="text/javascript" id="script-bundle" src="/portfolio-pages-public/js/main.bundle.min.24224d278b2cd9043bb95d246186d302ae3d77ce79c167550e7220387a5da9c00d69ba619920af359ba5ef6c846bbdfaaca3136a81aee4dc9d81cd614cfc9edb.js"
    integrity="sha512-JCJNJ4ss2QQ7uV0kYYbTAq49d855wWdVDnIgOHpdqcANabphmSCvNZul72yEa736rKMTaoGu5Nydgc1hTPye2w==" data-copy="" data-copied=""></script>
  
  
  <script src="/portfolio-pages-public/js/zoom.min.js"></script>
  
  
  
  <link rel="apple-touch-icon" sizes="180x180" href="/portfolio-pages-public/apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="/portfolio-pages-public/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="/portfolio-pages-public/favicon-16x16.png" />
  <link rel="manifest" href="/portfolio-pages-public/site.webmanifest" />
  
  
  
  
  
  
  
  <meta property="og:title" content="TheHive" />
<meta property="og:description" content="During a work term, I was given the chance to build out some open source tools that can be used to create a streamlined security operations center. It was a very valuable experience and helped me develop a better understanding of tooling available to organizations that may have resource limitations.
Here are some of the configuration steps and code that was used in the setup of the Hive server, a self-contained testing server to explore open-source SOC options." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://b1p01arc0nf1d3nc3.github.io/portfolio-pages-public/posts/thehive/" /><meta property="og:image" content="https://b1p01arc0nf1d3nc3.github.io/portfolio-pages-public/posts/thehive/featureh.png" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-09T19:04:27-04:00" />
<meta property="article:modified_time" content="2023-12-09T19:04:27-04:00" />


  <meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://b1p01arc0nf1d3nc3.github.io/portfolio-pages-public/posts/thehive/featureh.png" /><meta name="twitter:title" content="TheHive"/>
<meta name="twitter:description" content="During a work term, I was given the chance to build out some open source tools that can be used to create a streamlined security operations center. It was a very valuable experience and helped me develop a better understanding of tooling available to organizations that may have resource limitations.
Here are some of the configuration steps and code that was used in the setup of the Hive server, a self-contained testing server to explore open-source SOC options."/>

  
  <script type="application/ld+json">
  [{
    "@context": "https://schema.org",
    "@type": "Article",
    "articleSection": "Posts",
    "name": "TheHive",
    "headline": "TheHive",
    
    "abstract": "During a work term, I was given the chance to build out some open source tools that can be used to create a streamlined security operations center. It was a very valuable experience and helped me develop a better understanding of tooling available to organizations that may have resource limitations.\nHere are some of the configuration steps and code that was used in the setup of the Hive server, a self-contained testing server to explore open-source SOC options.",
    "inLanguage": "en-us",
    "url" : "https:\/\/b1p01arc0nf1d3nc3.github.io\/portfolio-pages-public\/posts\/thehive\/",
    "author" : {
      "@type": "Person",
      "name": ""
    },
    "copyrightYear": "2023",
    "dateCreated": "2023-12-09T19:04:27-04:00",
    "datePublished": "2023-12-09T19:04:27-04:00",
    
    "dateModified": "2023-12-09T19:04:27-04:00",
    
    
    
    "mainEntityOfPage": "true",
    "wordCount": "2171"
  }]
  </script>


  
  
  
  
  

<script src="/portfolio-pages-public/lib/jquery/jquery.slim.min.js" integrity=""></script>


















  
  

  
  
  <meta name="theme-color"/>
  
  
</head>
<body
  class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32">
  <div id="the-top" class="absolute flex self-center">
    <a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600"
      href="#main-content"><span
        class="font-bold text-primary-600 ltr:pr-2 rtl:pl-2 dark:text-primary-400">&darr;</span>Skip to main content</a>
  </div>
  
  
  <div style="padding-left:0;padding-right:0;padding-top:2px;padding-bottom:3px"
    class="main-menu flex items-center justify-between px-4 py-6 sm:px-6 md:justify-start space-x-3">
    
    <div class="flex flex-1 items-center justify-between">
        <nav class="flex space-x-3">

            
            <a href="/portfolio-pages-public/" class="text-base font-medium text-gray-500 hover:text-gray-900">b1p01arc0nf1d3nc3 - Portfolio</a>
            

        </nav>
        <nav class="hidden md:flex items-center space-x-5 md:ml-12 h-12">

            

            


            
            <button id="search-button" aria-label="Search" class="text-base hover:text-primary-600 dark:hover:text-primary-400 h-12"
                title="">
                

  <span class="relative block icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


            </button>
            


            
            
            <div
                class="ltr:mr-14 rtl:ml-14 cursor-pointer text-sm text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400">
                <button id="appearance-switcher" aria-label="Dark mode switcher" type="button">
                    <div class="flex items-center justify-center h-12 dark:hidden">
                        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>

  </span>


                    </div>
                    <div class="items-center justify-center hidden h-12 dark:flex">
                        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>

  </span>


                    </div>
                </button>
            </div>
            

        </nav>
        <div class="flex md:hidden items-center space-x-5 md:ml-12">

            <span></span>

            


            
            <button id="search-button-mobile" aria-label="Search" class="text-base hover:text-primary-600 dark:hover:text-primary-400"
                title="">
                

  <span class="relative block icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


            </button>
            

            
            
            <button id="appearance-switcher-mobile" aria-label="Dark mode switcher" type="button" style="margin-right:5px">
                <div class="flex items-center justify-center h-12 dark:hidden">
                    

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>

  </span>


                </div>
                <div class="items-center justify-center hidden h-12 dark:flex">
                    

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>

  </span>


                </div>
            </button>
            

        </div>
    </div>
    <div class="-my-2 -mr-2 md:hidden">

        <label id="menu-button" for="menu-controller" class="block">
            <input type="checkbox" id="menu-controller" class="hidden" />
            

            </div>
        </label>
    </div>
</div>




<script>
    (function () {
        var $mainmenu = $('.main-menu');
        var path = window.location.pathname;
        $mainmenu.find('a[href="' + path + '"]').each(function (i, e) {
            $(e).children('p').addClass('active');
        });
    })();
</script>


  
  <div class="relative flex flex-col grow">
    <main id="main-content" class="grow">
      


<article>
  

  <header id="single_header" class="mt-5 max-w-prose">
    
    <h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
      TheHive
    </h1>
    <div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden">
      




































<div style="cursor: default;" class="flex flex-row flex-wrap items-center">
  
  
  <time datetime="2023-12-09 19:04:27 -0400 AST">December 9, 2023</time><span class="px-2 text-primary-500">&middot;</span><span>2171 words</span><span class="px-2 text-primary-500">&middot;</span><span title="Reading time">11 mins</span>
  

  
  
</div>







    </div>

    
    
    
    
    

    
    
    
<div class="flex">
  
  <div class="place-self-center">
    
    
    <div class="text-2xl sm:text-lg">
</div>
  </div>
</div>
    

    

    

    
    <div class="mb-5"></div>
    
  
  </header>
  
  <section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row">
    
    

      <div class="min-w-0 min-h-0 max-w-fit">
        
        


        <div class="max-w-prose mb-20">
          <p>During a work term, I was given the chance to build out some open source tools that can be used to create a streamlined security operations center. It was a very valuable experience and helped me develop a better understanding of tooling available to organizations that may have resource limitations.</p>
<p>Here are some of the configuration steps and code that was used in the setup of the Hive server, a self-contained testing server to explore open-source SOC options.</p>
<p>Base OS: CentOS 7.
Requirements: Depending on the number of products you want to test at once, this could range from 8 - 32 GB.</p>
<p>Docker engine: simple install using yum:
<code>sudo yum install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin</code></p>
<p>Once docker is set up, start the service and check the inital <code>hello world</code> container can run. If it does, then we can start building the template for the SOC from the hosted page on github.</p>
<h3 class="relative group">Portainer 
    <div id="portainer" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#portainer" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>Using Portainer will make managing the large number of containers and images simpler. The container for Portainer can be installed by following the steps in this link:</p>
<p><a href="https://docs.portainer.io/start/install-ce/server/docker/linux"   target="_blank">
    Install Portainer with Docker on Linux -
Portainer Documentation</a></p>
<p>The basic steps are given below.</p>
<p><code>docker volume  name_of_data_storage_for_portainer</code></p>
<p>The above command will create a docker volume for Portainer. We can then run the docker command to pull in the image and map the ports we will use to connect to the web interface for managing containers.</p>
<p>I used:</p>
<p><code>docker run -d -p 8000:8000 -p 9443:9443 --name portainer --restart=always -v /var/run/docker.sock:/var/run/docker.sock -v name_of_data_storage_for_portainer:/data portainer/portainer-ce:2.9.3</code></p>
<p>though your command may look different depending on the versions and the ports you select.</p>
<p>For the web interface, Portainer will automatically create a self-signed certificate, but this can be changed both during and after installation, should this be a production environment.</p>
<hr>
<h3 class="relative group">SOC Components 
    <div id="soc-components" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#soc-components" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>The following tools were used to create the SOC, providing a wide range of functionality for small teams of security analysts.</p>
<ul>
<li><input disabled="" type="checkbox"> TheHive - incident platform to coordinate incident response and case collection</li>
<li><input disabled="" type="checkbox"> Cortex - analysis of events based indicators of compromise</li>
<li><input disabled="" type="checkbox"> MISP - shared threat intelligence platform</li>
<li><input disabled="" type="checkbox"> Shuffle - automation platform</li>
<li><input disabled="" type="checkbox"> ThePhish - email analysis and triage</li>
<li><input disabled="" type="checkbox"> Wazuh - endpoint monitoring</li>
<li><input disabled="" type="checkbox"> Assembly_Line - file analysis</li>
<li><input disabled="" type="checkbox"> Cuckoo_Sandbox - automated sandbox analysis environments</li>
</ul>
<p>The initial install takes care of many of the tools and will provide a backend database for storing case information. The details and highlights of configurations can be found at the following link. The template used includes an automation platform as well as integrations with MISP for sharing information with other SOCs.
<a href="https://github.com/TheHive-Project/Docker-Templates/tree/main/docker/thehive4-cortex3-misp-shuffle"   target="_blank">
    Docker-Templates/docker/thehive4-cortex3-misp-shuffle at main · TheHive-Project/Docker-Templates · GitHub</a></p>
<p>After cloning the above repo with</p>
<p><code>git clone https://github.com/TheHive-Project/Docker-Templates/tree/main/docker/thehive4-cortex3-misp-shuffle</code></p>
<p>you can also clone ThePhish:</p>
<p><code>git clone https://github.com/emalderson/ThePhish.git</code></p>
<p>If there are any later configuration issues, you can find the repository here: <a href="https://github.com/emalderson/ThePhish/tree/master/docker"   target="_blank">
    ThePhish/docker at master · emalderson/ThePhish · GitHub</a></p>
<p>The docker-compose.yaml file will then need to be customized to include the following information in order to add ThePhish to the template.</p>
<blockquote>
<p>thephish:
image: emalderson/thephish:latest
container_name: thephish
restart: unless-stopped
depends_on:
- thehive
- cortex
- misp
ports:
- &lsquo;0.0.0.0:8081:8080&rsquo;
volumes:
- ./ThePhish/app/analyzers_level_conf.json:/root/thephish/analyzers_level_conf.json
- ./ThePhish/app/configuration.json:/root/thephish/configuration.json
- ./ThePhish/app/whitelist.json:/root/thephish/whitelist.json</p>
</blockquote>
<p>I added this as the last container in the sequence and there were no issues pulling the image. As there are a multitude of containers that will be hosting web applications, the port mappings will need to be adjusted to ensure there is no unecessary overlap, which is where Portainer helps out by making it simpler to identify these kinds of issues and jump between container logs.</p>
<p>The default port mappings can be found in the initial docker-compose.yaml file, though I needed to change the mappings for MISP as port 8080 and 443 were occupied (there were also issues with Shuffle seemingly accessing port 443, which caused MISP to not be contactable); the Shuffle frontend as common ports were used; and ThePhish for the same reason.</p>
<p>After all ports have been mapped, you can choose to select <code>0.0.0.0</code> or your static ip as the route. I found that adding the specific ip sometimes help get around issues where the container frontend was unreachable.</p>
<p>After customizing the configurations, you can build the apps by changing to the parent directory (where the docker-compose.yaml is located if you are not already there) and running <code>docker compose up -d</code> (may need to &lsquo;sudo&rsquo; depending on how you configured docker) to begin the pull and build of all of the mentioned containers. You can check the status of the containers in the Portainer UI (reachable at https://server_ip:port_number). If there are issues with the containers, you can focus on them individually or bring them all down with <code>docker compose down</code>. You can then change the configuration in the docker-compose.yaml to remove any conflicts. When I integrated ThePhish, I did have some issues with conflicting files/directories, but this was likely due to trying to run the container for ThePhish in a separate compose and the paths to the configurations being misaligned. It might therefore be necessary to check the volume paths to ensure they are pointing in the right direction.</p>
<p>In its current iteration, ThePhish is designed to rely on a gmail account as the staging area for malicious emails to be sent. In order to change this, the ability to drag/drop or select local files could be added to the flask code that forms the basis of the app. However, for this setup a gmail address was created and used to contact the server. The configuration steps can be found here: <a href="https://github.com/emalderson/ThePhish/tree/master/docker"   target="_blank">
    ThePhish/docker at master · emalderson/ThePhish · GitHub</a> After adding the gmail account details and app password found in account management to the <code>configuration.json</code> file in the app directory within the container, you can also add the URL and API of TheHive and the Cortex instance. The inbox of the account will then be able to pass .eml files to the analyzers and integrate with TheHive and Cortex by automatically accessing analyzers and using a case template to send a response email once the mailer responder is accurately configured in Cortex. Cortex will need the email address to use, the host, use of port 587, and the SMTP user and password configured.</p>
<h3 class="relative group">User creation in TheHive, Cortex, and MISP 
    <div id="user-creation-in-thehive-cortex-and-misp" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#user-creation-in-thehive-cortex-and-misp" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>Default user logins for each app can be found in the docker template readme on github.</p>
<p>To create a user in TheHive, you will first need to create an organization to assign them to. After using the default account to sign in, you can create the first organization and users by clicking through the UI with options generally in the top banner. You can set their passwords and generate API tokens that can be placed into app configuration files if needed.</p>
<p>Similarly, for Cortex, you will need to create an organization and users in the same manner.
The API token for the app instance can then be placed into the <code>application.conf</code> file within TheHive&rsquo;s directory on the server (for me this was located within my home directory where I cloned the template repo). This is also where you will need to add details about the MISP instance, such as the API key and the IP address/port where the instance can be reached.</p>
<p>To integrate MISP, grab the API key after logging in with the default credentials and creating the first organization. After adding the info to the <code>application.conf</code> file the integrations between the three apps should be ready to go. You will be able to spend some time looking at analyzers to set up and responders you would like to use. The configuration of some analyzers is done automatically.</p>
<h3 class="relative group">Adding the Shuffle webhook 
    <div id="adding-the-shuffle-webhook" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#adding-the-shuffle-webhook" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>As there are a lot of apps included in this version of Shuffle, the container may have issues with memory and caching of the apps on the initial load. Pausing the container and giving it some time to process the cache seemed to work and allowed the container to become more stable. As outlined in the docker template documentation, the webhook uri will need to be put into the <code>application.conf</code> file specifying the organization in TheHive. Webhooks are also disabled by default and will need to be enabled following the instructions in the readme. Unfortunately, the link they use for how do this specifically is broken, but you can use the example listed as a framework for how to fill in your user details and find the listed file.</p>
<blockquote>
<p>read -p &lsquo;Enter the URL of TheHive: &rsquo; thehive_url
read -p &lsquo;Enter your login: &rsquo; thehive_user
read -s -p &lsquo;Enter your password: &rsquo; thehive_password</p>
</blockquote>
<p>`curl -XPUT -u$thehive_user:$thehive_password -H &lsquo;Content-type: application/json&rsquo; $thehive_url/api/config/organisation/notification -d '
<code>{ </code>&ldquo;value&rdquo;: [
<code>{</code>
<code>&quot;delegate&quot;: false, </code>&ldquo;trigger&rdquo;: { &ldquo;name&rdquo;: &ldquo;AnyEvent&rdquo;},
<code>&quot;notifier&quot;: { &quot;name&quot;: &quot;webhook&quot;, &quot;endpoint&quot;: &quot;local&quot; } </code>}<code> </code>]<code> </code>}``</p>
<p>Once the webhooks are enabled you should be able to begin making workflows in the Shuffle frontend.</p>
<h2 class="relative group">Wazuh in docker 
    <div id="wazuh-in-docker" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#wazuh-in-docker" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<p>The next piece of the SOC is Wazuh for endpoint management. The steps can be found here: <a href="https://documentation.wazuh.com/current/deployment-options/docker/wazuh-container.html"   target="_blank">
    Wazuh Docker deployment - Deployment on Docker · Wazuh documentation</a>
The path I followed was single-node deployment. Once the repo has been cloned, change to the single node directory and run the command to generate certificates using a provided container <code>docker-compose -f generate-indexer-certs.yml run --rm generator</code>. You can then go to the directory with the docker-compose.yaml and check the configuration to see if there are any port assignment clashes. There might also be a clash within the <code>opensearch_dashboards.yaml</code> file  in the /single-node/config/wazuh_dashboard directory. You can also change the information for the user login and password within the yaml file before running the group of containers with <code>docker compose up -d</code>.  Once set up, you can begin to add agents to the network and begin collecting data related to your endpoints. The default configuration contains a lot of rules that collect data related to privilege escalation and you can add some responses to common attacks such as a brute force or sql injection attack. The granularity you can achieve with these rules seems quite high. Results can be filtered by rule_id among a host of other options to identify relevant data and to view the effectiveness of a given rule. Rules can be added in  <code>/var/ossec/etc/rules/</code>. There is a large repository on github that has collections of rules that could be used as the basis for a production configuration.
The current up to date list of rules can be found here: <a href="https://github.com/wazuh/wazuh/tree/master/ruleset"   target="_blank">
    wazuh/ruleset at master · wazuh/wazuh · GitHub</a></p>
<h2 class="relative group">Assembly Line 
    <div id="assembly-line" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#assembly-line" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<p>The tools to run Assembly Line in docker can be found here: <a href="https://cybercentrecanada.github.io/assemblyline4_docs/installation/appliance/docker/"   target="_blank">
    Docker - Assemblyline 4 (cybercentrecanada.github.io)</a>. The setup is similar to the other containerized tools and requires a python environment, docker compose, and a firewall configuration for the minimal install.  After these changes, clone the repo with git clone:
<code>git clone https://github.com/CybercentreCanada/assemblyline-docker-compose.git</code>and change into the <code>deployments/assemblyline</code> directory to begin making changes to the
config.yaml file. It is set to run as a single node by default and has default login credentials that can be changed within the .env file inside of the deployment directory.</p>
<p>The next step is to create your https certificates or assign them from your local CA. If creating your own, this can be done with <code>openssl req -nodes -x509 -newkey rsa:4096 -keyout ~/deployments/assemblyline/config/nginx.key -out ~/deployments/assemblyline/config/nginx.crt -days 365 -subj &quot;/C=CA/ST=Ontario/L=Ottawa/O=CCCS/CN=assemblyline.local&quot;</code>.</p>
<p>When inside of the <code>deployments/assemblyline</code> directory, you can compose the build and the web interface will come up, reachable at the chosen port. After logging in, you can then configure which services you want to use from the ones available. The defaults have some utility and can break down .exe files and weblinks among other file types. Many of the tools do not require added configuraton, but the most useful will require some added API information and port connections (e.g., Yara). In order to get the most out of Cuckoo, for example, there is a decent amount of configuration required and the server you are using will have fairly high resource requirements.</p>
<h2 class="relative group">Cuckoo Sandbox 
    <div id="cuckoo-sandbox" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#cuckoo-sandbox" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<p>In order to create an environment that could be used to track the effects of a file/attachment in operation, you can setup up a Cuckoo VM which will allow you to then pass information to Assembly Line. This also allows you to monitor attempted network activity to some extent and to test the file within different OS environments. On the linux server I was using, this starts with creating a VM using KVM and assigning it an ip within an isolated network.</p>
<p>The configuration for the VM can be automated with a tool called VMCloak (documentation here: <a href="https://vmcloak.readthedocs.io/en/latest/"   target="_blank">
    Welcome to VMCloak’s documentation! — VMCloak 4.x documentation</a>) to allow you to quickly spin up new environments for testing. I did not use this approach as I was relying on a single server and the configuration likely would have required more resources than I had available. Using VMCloak would be a better production solution as it would streamline a lot of the configurations needed, and once 2/3 machine configurations that adequately duplicate the operating environments you want to focus on are made, they can be used within both Cuckoo and Assembly Line more easily.</p>

        </div>
                
        

        

          
      </div>
     
     <script>
        var oid = "views_posts\\TheHive\\index.md"
        var oid_likes = "likes_posts\\TheHive\\index.md"
      </script>
      
      
      <script type="text/javascript" src="/portfolio-pages-public/js/page.min.5b1bad196a6075a1e11bae1dc95f24f67b610948a00525e347566c5a62338ea78f1c7224ab9a53873dcdb2a1a7d7d391b8a8ef45561297f68806c01315b0c4f6.js" integrity="sha512-WxutGWpgdaHhG64dyV8k9nthCUigBSXjR1ZsWmIzjqePHHIkq5pThz3NsqGn19ORuKjvRVYSl/aIBsATFbDE9g=="></script>
  
    </section>
  <footer class="pt-8 max-w-prose print:hidden">

    
  
    
    
    
    <div class="pt-8">
      <hr class="border-dotted border-neutral-300 dark:border-neutral-600" />
      <div class="flex justify-between pt-3">
        <span>
          
        </span>
        <span>
          
            <a class="flex text-right group ml-3" href="/portfolio-pages-public/posts/backdoors-and-breaches/">
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >Backdoors and Breaches</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                    <time datetime="2023-12-09 19:04:41 -0400 AST">December 9, 2023</time>
                  
                </span>
              </span>
              <span
                class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400"
                >&rarr;</span
              >
              <span
                class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400"
                >&larr;</span
              >
            </a>
          
        </span>
      </div>
    </div>
  


    
  </footer>
</article>

      <div id="top-scroller" class="pointer-events-none absolute top-[110vh] bottom-0 w-12 ltr:right-0 rtl:left-0">
  <a href="#the-top"
    class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 mb-16 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 backdrop-blur hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400"
    aria-label="Scroll to top" title="Scroll to top">
    &uarr;
  </a>
</div>
    </main><footer id="site-footer" class="py-10 print:hidden">
  
  
    
  
  <div class="flex items-center justify-between">

    
    
    <p class="text-sm text-neutral-500 dark:text-neutral-400">
      &copy;
      2023
      
    </p>
    

    
    
    <p class="text-xs text-neutral-500 dark:text-neutral-400">
      
      
      Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
        href="https://gohugo.io/" target="_blank" rel="noopener noreferrer">Hugo</a> &amp; <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
        href="https://blowfish.page/" target="_blank" rel="noopener noreferrer">Blowfish</a>
    </p>
    

  </div>
  <script>
    
    mediumZoom(document.querySelectorAll("img:not(.nozoom)"), {
      margin: 24,
      background: 'rgba(0,0,0,0.5)',
      scrollOffset: 0,
    })
    
  </script>
  
  
  <script type="text/javascript" src="/portfolio-pages-public/js/process.min.62060bb247f4de2b6dde45903668fefb68d792f365587605177b1227c0cf43588701edaca0cb40e2c8e2789bd5ce67c1d2a215b9fb258c3496a7cd25e7cb5fdf.js" integrity="sha512-YgYLskf03itt3kWQNmj&#43;&#43;2jXkvNlWHYFF3sSJ8DPQ1iHAe2soMtA4sjieJvVzmfB0qIVufsljDSWp80l58tf3w=="></script>
  
  
</footer><div
  id="search-wrapper"
  class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh]"
  data-url="https://b1p01arc0nf1d3nc3.github.io/portfolio-pages-public/"
  style="z-index:500"
>
  <div
    id="search-modal"
    class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"
  >
    <header class="relative z-10 flex items-center justify-between flex-none px-2">
      <form class="flex items-center flex-auto min-w-0">
        <div class="flex items-center justify-center w-8 h-8 text-neutral-400">
          

  <span class="relative block icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


        </div>
        <input
          type="search"
          id="search-query"
          class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent"
          placeholder="Search"
          tabindex="0"
        />
      </form>
      <button
        id="close-search-button"
        class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"
        title="Close (Esc)"
      >
        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>

  </span>


      </button>
    </header>
    <section class="flex-auto px-2 overflow-auto">
      <ul id="search-results">
        
      </ul>
    </section>
  </div>
</div>

  </div>
</body>

</html>
